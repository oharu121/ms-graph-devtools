# Dev Notes - November 26, 2025

## ESLint Configuration Fix: Node.js Globals for Example Files

### Problem

ESLint errors appeared in example files:
```
examples/advanced-usage.ts:383:5   error  'require' is not defined  no-undef
examples/advanced-usage.ts:383:22  error  'module' is not defined   no-undef
examples/basic-usage.ts:268:5     error  'require' is not defined  no-undef
examples/basic-usage.ts:268:22    error  'module' is not defined   no-undef
examples/fluent-email.ts:148:5    error  'require' is not defined  no-undef
examples/fluent-email.ts:148:22   error  'module' is not defined   no-undef
```

All example files use the CommonJS pattern to detect if they're being run directly:
```typescript
if (require.main === module) {
  // Run examples when executed directly
}
```

### Root Cause

The ESLint flat config ([eslint.config.js](../eslint.config.js)) defines TypeScript globals for `.ts` files, but `require` and `module` (Node.js CommonJS globals) were not included. The example files section only had rule overrides, not additional globals.

### Solution

Added `require` and `module` as readonly globals to the example files configuration:

```javascript
// Example files - allow any type and ts-nocheck for demo purposes
{
  files: ['examples/**/*.ts'],
  languageOptions: {
    globals: {
      require: 'readonly',
      module: 'readonly',
    },
  },
  rules: {
    '@typescript-eslint/no-explicit-any': 'off',
    '@typescript-eslint/ban-ts-comment': 'off',
    '@typescript-eslint/no-unused-vars': 'off',
  },
},
```

### How ESLint Flat Config Works

ESLint flat config (introduced in ESLint 9) uses an array of configuration objects that are merged in order:

1. **Base configs** apply to all files
2. **File-specific configs** use `files` glob patterns to target specific files
3. **Later configs override earlier ones** for the same files

In our case:
- Line 24-57: TypeScript config for all `**/*.ts` files (defines base globals like `console`, `process`, etc.)
- Line 59-73: Example files config for `examples/**/*.ts` (adds `require`, `module` globals + relaxed rules)

The `languageOptions.globals` from the example files config **merges** with the base TypeScript globals, so example files get all the standard Node.js globals PLUS the CommonJS-specific ones.

### Why `require.main === module` Pattern?

This is a Node.js idiom to check if a file is being run directly vs imported as a module:

```typescript
// When running: node examples/basic-usage.ts
// require.main === module � true

// When importing: import './basic-usage'
// require.main === module � false
```

It allows example files to be both:
- **Runnable** - Execute examples when run directly
- **Importable** - Export functions for testing or reuse

### Files Modified

- [eslint.config.js](../eslint.config.js) - Added `languageOptions.globals` with `require` and `module`

### Verification

```bash
npm run lint  #  Passes with no errors
```

### Related

- [ESLint Flat Config Docs](https://eslint.org/docs/latest/use/configure/configuration-files)
- [Node.js require.main](https://nodejs.org/api/modules.html#requiremain)
